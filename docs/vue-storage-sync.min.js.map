{"version":3,"file":"vue-storage-sync.min.js","sources":["../src/index.js"],"sourcesContent":["/* eslint no-undef: 'off' */\n/**\n * @module VueStorageSync\n * @description A plugin to sync vue data to a storage system\n */\n\n/**\n * @prop pluginDefaultOptions\n * @desc Stores plugin default options\n * @type Object\n */\nconst pluginDefaultOptions = {\n  key: 'vue-data-sync',\n  duration: 0,\n  storage: 'local',\n};\n\n/**\n * @func storageSystems\n * @desc Plugin storage systems supported\n * @type {Array}\n */\nconst storageSystems = {\n  local: {\n    set(key, value) {\n      return window.localStorage.setItem(key, value);\n    },\n    get(key) {\n      return window.localStorage.getItem(key);\n    },\n    remove(key) {\n      return window.localStorage.removeItem(key);\n    },\n  },\n  session: {\n    set(key, value) {\n      return window.sessionStorage.setItem(key, value);\n    },\n    get(key) {\n      return window.sessionStorage.getItem(key);\n    },\n    remove(key) {\n      return window.sessionStorage.removeItem(key);\n    },\n  },\n};\n\n/**\n * @func getOptions\n * @desc get current options\n * @return Object\n */\nconst getOptions = function (options) {\n  // Plugin instance default options\n  const defaultOptions = Object.assign(\n    {},\n    VueStorageSync.pluginDefaultOptions,\n    VueStorageSync.userDefaultOptions,\n  );\n\n  // For array like settings\n  if (Array.isArray(options)) {\n    defaultOptions.entries = options;\n    return [defaultOptions];\n  }\n\n  // Check multiple storage systems\n  const isMultipleStorage = Object.keys(options).some(key => Object.keys(storageSystems).includes(key));\n\n  if (isMultipleStorage) {\n    // eslint-disable-next-line array-callback-return, consistent-return\n    return Object.keys(storageSystems).map((system) => {\n      if (options[system] != null) {\n        return Object.assign({}, defaultOptions, options[system], { storage: system });\n      }\n    });\n  }\n\n  // Single storage system\n  return [Object.assign({}, defaultOptions, options)];\n};\n\n/**\n * @func isExpired\n * @desc Check if a time is minor tha now\n * @return Boolean\n */\nconst isExpired = (time) => {\n  time = Number.parseInt(time, 10);\n  if (time === 0) return false;\n  return time < new Date().getTime() / 1000;\n};\n\n/**\n * @func getData\n * @desc Retrieves a data object\n * @return Object|null\n */\nconst getData = function (options) {\n  // Update options\n  options = getOptions(options)[0]; // eslint-disable-line prefer-destructuring\n\n  const store = storageSystems[options.storage];\n  const key = options.suffix ? `${options.key}/${options.suffix}` : options.key;\n  const storedObject = JSON.parse(store.get(key));\n\n  if (!storedObject) return {};\n  if (isExpired(storedObject.expires)) {\n    store.remove(key);\n    return {};\n  }\n  return storedObject.data;\n};\n\n/**\n * @func getData\n * @desc Retrieves a data object\n * @return Object|null\n */\nconst setData = function (prop, value, options) {\n  // Update options\n  options = getOptions(options)[0]; // eslint-disable-line prefer-destructuring\n\n  const store = storageSystems[options.storage];\n  const data = getData(options);\n  data[prop] = value;\n  const expires = options.duration > 0 ? options.duration + new Date().getTime() / 1000 : 0;\n  const newData = { data, expires };\n  const key = options.suffix ? `${options.key}/${options.suffix}` : options.key;\n  return store.set(key, JSON.stringify(newData));\n};\n\n/**\n * @func storageSync\n * @desc main sync function\n */\nconst storageSync = function (options = {}) {\n  // Get current options\n  options = getOptions(options);\n  // Each storage\n  options.forEach((option) => {\n    const storedData = getData(option);\n    if (storedData) {\n      Object.keys(storedData).forEach((item) => {\n        this[item] = storedData[item];\n      });\n    }\n\n    if (option.entries != null) {\n      // Register watchers\n      option.entries.forEach((prop) => {\n        this.$watch(\n          prop,\n          // eslint-disable-next-line prefer-arrow-callback\n          function (value) {\n            setData(prop, value, option);\n          },\n          {\n            deep: true,\n          },\n        );\n      });\n    }\n  });\n};\n\n/**\n * @func onBeforeCreate\n * @desc Mixin function for beforeCreate hook\n */\nconst onBeforeCreate = function () {\n  this.$storageSync = storageSync;\n};\n\n/**\n * @func onCreated\n * @desc Mixin function for beforeCreate hook\n */\nconst onCreated = function () {\n  const { storage } = this.$options;\n  if (storage) this.$storageSync(storage);\n};\n\n/**\n * @func install\n * @desc Install the plugin\n * @param {Vue} Vue the vuejs object\n * @param {Object} userDefaultOptions Options object\n */\nconst install = function (Vue, userDefaultOptions = {}) {\n  // Get default options\n  this.pluginDefaultOptions = pluginDefaultOptions;\n  this.userDefaultOptions = userDefaultOptions;\n  // Set the mixin\n  Vue.mixin({\n    beforeCreate: onBeforeCreate,\n    created: onCreated,\n  });\n};\n\n/**\n * @exports VueStorageSync\n * @type {Object}\n * @desc Object module\n */\nexport default {\n  install,\n};\n"],"names":["pluginDefaultOptions","key","duration","storage","storageSystems","local","set","value","window","localStorage","setItem","get","getItem","remove","removeItem","session","sessionStorage","getOptions","options","defaultOptions","Object","assign","VueStorageSync","userDefaultOptions","Array","isArray","entries","keys","some","includes","map","system","getData","time","store","suffix","storedObject","JSON","parse","expires","Number","parseInt","Date","getTime","data","storageSync","forEach","option","storedData","item","_this","prop","$watch","newData","stringify","setData","deep","onBeforeCreate","$storageSync","onCreated","this","$options","install","Vue","mixin","beforeCreate","created"],"mappings":";;;;;0LAWA,IAAMA,GACJC,IAAK,gBACLC,SAAU,EACVC,QAAS,SAQLC,GACJC,OACEC,aAAIL,EAAKM,UACAC,OAAOC,aAAaC,QAAQT,EAAKM,IAE1CI,aAAIV,UACKO,OAAOC,aAAaG,QAAQX,IAErCY,gBAAOZ,UACEO,OAAOC,aAAaK,WAAWb,KAG1Cc,SACET,aAAIL,EAAKM,UACAC,OAAOQ,eAAeN,QAAQT,EAAKM,IAE5CI,aAAIV,UACKO,OAAOQ,eAAeJ,QAAQX,IAEvCY,gBAAOZ,UACEO,OAAOQ,eAAeF,WAAWb,MAUxCgB,EAAa,SAAUC,OAErBC,EAAiBC,OAAOC,UAE5BC,eAAetB,qBACfsB,eAAeC,2BAIbC,MAAMC,QAAQP,IAChBC,EAAeO,QAAUR,GACjBC,IAIgBC,OAAOO,KAAKT,GAASU,KAAK,SAAA3B,UAAOmB,OAAOO,KAAKvB,GAAgByB,SAAS5B,KAIvFmB,OAAOO,KAAKvB,GAAgB0B,IAAI,SAACC,MACf,MAAnBb,EAAQa,UACHX,OAAOC,UAAWF,EAAgBD,EAAQa,IAAW5B,QAAS4B,OAMnEX,OAAOC,UAAWF,EAAgBD,KAmBtCc,EAAU,SAAUd,GAExBA,EAAUD,EAAWC,GAAS,OAbbe,EAeXC,EAAQ9B,EAAec,EAAQf,SAC/BF,EAAMiB,EAAQiB,iBAAYjB,EAAQjB,gBAAOiB,EAAQiB,QAAWjB,EAAQjB,IACpEmC,EAAeC,KAAKC,MAAMJ,EAAMvB,IAAIV,WAErCmC,GAnBYH,EAoBHG,EAAaG,QAlBd,KADbN,EAAOO,OAAOC,SAASR,EAAM,MAEtBA,GAAO,IAAIS,MAAOC,UAAY,KAkBnCT,EAAMrB,OAAOZ,OAGRmC,EAAaQ,UAyBhBC,EAAc,sBAAU3B,6DAE5BA,EAAUD,EAAWC,IAEb4B,QAAQ,SAACC,OACTC,EAAahB,EAAQe,GACvBC,GACF5B,OAAOO,KAAKqB,GAAYF,QAAQ,SAACG,GAC/BC,EAAKD,GAAQD,EAAWC,KAIN,MAAlBF,EAAOrB,SAETqB,EAAOrB,QAAQoB,QAAQ,SAACK,GACtBD,EAAKE,OACHD,WAEU5C,IAnCJ,SAAU4C,EAAM5C,EAAOW,GAErCA,EAAUD,EAAWC,GAAS,OAExBgB,EAAQ9B,EAAec,EAAQf,SAC/ByC,EAAOZ,EAAQd,GACrB0B,EAAKO,GAAQ5C,MAEP8C,GAAYT,KAAAA,EAAML,QADRrB,EAAQhB,SAAW,EAAIgB,EAAQhB,UAAW,IAAIwC,MAAOC,UAAY,IAAO,GAElF1C,EAAMiB,EAAQiB,iBAAYjB,EAAQjB,gBAAOiB,EAAQiB,QAAWjB,EAAQjB,IACnEiC,EAAM5B,IAAIL,EAAKoC,KAAKiB,UAAUD,IA0B3BE,CAAQJ,EAAM5C,EAAOwC,KAGrBS,MAAM,SAYZC,EAAiB,gBAChBC,aAAeb,GAOhBc,EAAY,eACRxD,EAAYyD,KAAKC,SAAjB1D,QACJA,GAASyD,KAAKF,aAAavD,WA0B/B2D,QAjBc,SAAUC,OAAKxC,iEAExBvB,qBAAuBA,OACvBuB,mBAAqBA,EAE1BwC,EAAIC,OACFC,aAAcR,EACdS,QAASP"}